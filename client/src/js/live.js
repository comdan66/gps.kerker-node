/**
 * @author      OA Wu <comdan66@gmail.com>
 * @copyright   Copyright (c) 2015 - 2020, Ginkgo
 * @license     http://opensource.org/licenses/MIT  MIT License
 * @link        https://www.ioa.tw/
 */

Load.init({
  data: {
    error: '',
    total: 0,
    gmap: null,
    default: {
      zoom: 16,
      lat: 24.998270,
      lng: 121.520158
    },
    // lastZoom: null,
    // socket: null,
    
    // devices: [],
    // device: null,

    // markers: [],
    // polylines: [],
    polyline: null,

    // speedsClick: false,

    // colors: ['#f5c801', '#fbbb03', '#fcab0a', '#fc9913', '#fb871d', '#fa7226', '#f95d30', '#f94739', '#f93748', '#f72b5e']
  },
  mounted () {
    this.socket = io.connect(SOCKET, { path: '/live', reconnection: false })

    this.socket.on('connect', _ => this.socket.emit('inited'))
    this.socket.on('online', total => this.total = total)
    this.socket.on('keys', keys => GoogleMap.init(keys, _ => {

      this.gmap = new google.maps.Map(
        this.$refs.map, {
          zoom: this.default.zoom,
          center: position(this.default),
          clickableIcons: false,
          disableDefaultUI: true,
          gestureHandling: 'greedy' })

      // let a = 
        // this.polyline = new google.maps.Polyline({ map: this.gmap, strokeColor: 'rgba(66, 133, 244, 1.00)', strokeWeight: 3 })
        // this.polyline.setPath([[24.997800, 121.520299], [24.997800, 121.520299], [24.997803, 121.520304], [24.997804, 121.520318], [24.997790, 121.520283], [24.997800, 121.520304], [24.997804, 121.520335], [24.997791, 121.520285], [24.997803, 121.520310], [24.997849, 121.520247], [24.997980, 121.520011], [24.997804, 121.520261], [24.997791, 121.520325], [24.997802, 121.520250], [24.997840, 121.520173], [24.997839, 121.520258], [24.997874, 121.520102], [24.997879, 121.520070], [24.997802, 121.520079], [24.997868, 121.520111], [24.997883, 121.519911], [24.998067, 121.519968], [24.998116, 121.519999], [24.997861, 121.520055], [24.997900, 121.520017], [24.997967, 121.520007], [24.998031, 121.520019], [24.997963, 121.520040], [24.998053, 121.519920], [24.997980, 121.519854], [24.997974, 121.519945], [24.997980, 121.519976], [24.997980, 121.520016], [24.997980, 121.520047], [24.997955, 121.520063], [24.997955, 121.520121], [24.997941, 121.520148], [24.997911, 121.520157], [24.997879, 121.520167], [24.997834, 121.520132], [24.997827, 121.520094], [24.997832, 121.520047], [24.997844, 121.519983], [24.997859, 121.519901], [24.997873, 121.519813], [24.997885, 121.519728], [24.997898, 121.519644], [24.997910, 121.519559], [24.997919, 121.519467], [24.997897, 121.519307], [24.997882, 121.519236], [24.997870, 121.519158], [24.997863, 121.519101], [24.997849, 121.519020], [24.997846, 121.518924], [24.997837, 121.518843], [24.997877, 121.518803], [24.997904, 121.518742], [24.997933, 121.518676], [24.997940, 121.518625], [24.997948, 121.518589], [24.997925, 121.518571], [24.997914, 121.518524], [24.997904, 121.518486], [24.997889, 121.518448], [24.997881, 121.518402], [24.997889, 121.518365], [24.997903, 121.518332], [24.997944, 121.518343], [24.997989, 121.518362], [24.998066, 121.518375], [24.998120, 121.518408], [24.998175, 121.518428], [24.998246, 121.518441], [24.998315, 121.518440], [24.998381, 121.518452], [24.998453, 121.518475], [24.998522, 121.518479], [24.998591, 121.518496], [24.998665, 121.518507], [24.998715, 121.518521], [24.998784, 121.518541], [24.998843, 121.518562], [24.998913, 121.518580], [24.999000, 121.518601], [24.999070, 121.518633], [24.999142, 121.518625], [24.999219, 121.518648], [24.999298, 121.518656], [24.999365, 121.518664], [24.999417, 121.518684], [24.999480, 121.518712], [24.999519, 121.518718], [24.999547, 121.518725], [24.999572, 121.518747], [24.999627, 121.518778], [24.999675, 121.518801], [24.999720, 121.518823], [24.999768, 121.518841], [24.999795, 121.518854], [25.000191, 121.518753], [25.000195, 121.518633], [25.000184, 121.518750], [25.000186, 121.518698], [25.000189, 121.518651], [25.000186, 121.518717], [25.000189, 121.518726], [25.000194, 121.518603], [25.000199, 121.518491], [25.000205, 121.518545], [25.000201, 121.518423], [25.000183, 121.518769], [25.000192, 121.518654], [25.000193, 121.518612], [25.000194, 121.518604], [25.000191, 121.518639], [25.000199, 121.518640], [25.000193, 121.518551], [25.000189, 121.518594], [25.000185, 121.518653], [25.000186, 121.518729], [25.000206, 121.518579], [25.000189, 121.518724], [25.000196, 121.518410], [25.000201, 121.518299], [25.000197, 121.518472], [25.000206, 121.518579], [25.000195, 121.518527], [25.000189, 121.518642], [25.000185, 121.518695], [25.000194, 121.518601], [25.000191, 121.518639], [25.000190, 121.518574], [25.000193, 121.518573], [25.000192, 121.518610], [25.000190, 121.518685], [25.000193, 121.518546], [25.000196, 121.518405], [25.000190, 121.518586], [25.000188, 121.518678], [25.000188, 121.518746], [25.000189, 121.518726], [25.000198, 121.518653], [25.000207, 121.518511], [25.000195, 121.518603], [25.000196, 121.518410], [25.000185, 121.518528], [25.000189, 121.518649], [25.000193, 121.518548], [25.000190, 121.518641], [25.000183, 121.518753], [25.000189, 121.518650], [25.000189, 121.518725], [25.000189, 121.518600], [25.000194, 121.518597], [25.000194, 121.518520], [25.000198, 121.518555], [25.000194, 121.518597], [25.000193, 121.518542], [25.000189, 121.518797], [25.000188, 121.518877], [25.000189, 121.518793], [25.000192, 121.518649], [25.000192, 121.518609], [25.000194, 121.518600], [25.000189, 121.518786], [25.000193, 121.518683], [25.000194, 121.518631], [25.000198, 121.518588], [25.000199, 121.518532], [25.000196, 121.518593], [25.000202, 121.518614], [25.000194, 121.518674], [25.000194, 121.518603], [25.000189, 121.518723], [25.000189, 121.518608], [25.000205, 121.518541], [25.000190, 121.518643], [25.000193, 121.518612], [25.000189, 121.518719], [25.000194, 121.518611], [25.000199, 121.518482], [25.000194, 121.518511], [25.000199, 121.518540], [25.000199, 121.518621], [25.000193, 121.518532], [25.000194, 121.518485], [25.000193, 121.518544], [25.000194, 121.518599], [25.000189, 121.518722], [25.000188, 121.518754], [25.000189, 121.518617], [25.000190, 121.518581], [25.000202, 121.518613], [25.000189, 121.518682], [25.000188, 121.518724], [25.000189, 121.518726], [25.000189, 121.518601], [25.000205, 121.518580], [25.000191, 121.518710], [24.999808, 121.518839], [24.999828, 121.518835], [24.999852, 121.518855], [24.999918, 121.518889], [24.999969, 121.518889], [24.999994, 121.518901], [25.000030, 121.518908], [25.000054, 121.518923], [25.000141, 121.518914], [25.000172, 121.518908], [25.000186, 121.518879], [25.000186, 121.518829], [25.000170, 121.518801], [25.000140, 121.518802], [25.000135, 121.518762], [25.000135, 121.518797], [25.000110, 121.518767], [25.000101, 121.518738], [25.000107, 121.518707], [25.000115, 121.518673], [25.000124, 121.518637], [25.000129, 121.518608], [25.000129, 121.518575], [25.000098, 121.518553], [25.000071, 121.518539], [25.000054, 121.518566], [25.000119, 121.518630], [25.000166, 121.518678], [25.000189, 121.518472], [25.000189, 121.518521], [25.000195, 121.518417], [25.000196, 121.518542], [25.000191, 121.518583], [25.000184, 121.518642], [25.000190, 121.518610], [25.000185, 121.518676], [25.000194, 121.518546], [25.000196, 121.518606], [25.000186, 121.518733], [25.000188, 121.518700], [25.000184, 121.518760], [25.000194, 121.518676], [25.000189, 121.518793], [25.000192, 121.518727], [25.000197, 121.518671], [25.000192, 121.518616], [25.000189, 121.518733], [25.000188, 121.518770], [25.000200, 121.518639], [25.000190, 121.518754], [25.000189, 121.518598], [25.000189, 121.518719], [25.000194, 121.518687], [25.000195, 121.518750], [25.000201, 121.518622], [25.000196, 121.518585], [25.000192, 121.518661], [25.000192, 121.518666], [25.000185, 121.518753], [25.000190, 121.518704], [25.000200, 121.518631], [25.000189, 121.518693], [25.000191, 121.518643], [25.000185, 121.518702], [25.000191, 121.518660], [25.000208, 121.518439], [25.000203, 121.518516], [25.000196, 121.518589], [25.000192, 121.518670], [25.000195, 121.518623], [25.000186, 121.518753], [25.000195, 121.518588], [25.000196, 121.518568], [25.000193, 121.518661], [25.000194, 121.518615], [25.000197, 121.518578], [25.000192, 121.518653], [25.000188, 121.518697], [25.000188, 121.518735], [25.000194, 121.518614], [25.000190, 121.518779], [25.000186, 121.518889], [25.000189, 121.518795], [25.000191, 121.518735], [25.000205, 121.518561], [25.000190, 121.518721], [25.000197, 121.518656], [25.000195, 121.518592], [25.000184, 121.518772], [25.000189, 121.518804], [25.000194, 121.518589], [25.000186, 121.518753], [25.000193, 121.518675], [25.000189, 121.518727], [25.000186, 121.518838], [25.000185, 121.518805], [25.000201, 121.518586], [25.000188, 121.518670], [25.000185, 121.518773], [25.000191, 121.518711], [25.000197, 121.518635], [25.000190, 121.518721], [25.000195, 121.518560], [25.000203, 121.518493], [25.000199, 121.518558], [25.000195, 121.518631], [25.000196, 121.518410], [25.000195, 121.518234], [25.000185, 121.518674], [25.000189, 121.518731], [25.000192, 121.518762], [25.000187, 121.518736], [25.000193, 121.518575], [25.000190, 121.518717], [25.000189, 121.518726], [25.000194, 121.518686], [25.000194, 121.518603], [25.000203, 121.518496], [25.000195, 121.518581], [25.000199, 121.518491], [25.000202, 121.518408], [25.000197, 121.518538], [25.000198, 121.518573], [25.000197, 121.518611], [25.000189, 121.518758], [25.000189, 121.518824], [25.000189, 121.518876], [25.000190, 121.518823], [25.000326, 121.518688], [25.000279, 121.518851], [25.000223, 121.518782], [25.000180, 121.518804], [25.000153, 121.518815], [25.000125, 121.518841], [25.000133, 121.518798], [25.000136, 121.518768], [25.000131, 121.518722], [25.000118, 121.518670], [25.000110, 121.518616], [25.000107, 121.518556], [25.000110, 121.518497], [25.000108, 121.518448], [25.000099, 121.518404], [25.000093, 121.518357], [25.000092, 121.518313], [25.000096, 121.518271], [25.000101, 121.518232], [25.000106, 121.518196], [25.000113, 121.518150], [25.000118, 121.518095], [25.000121, 121.518039], [25.000121, 121.517988], [25.000135, 121.517949], [25.000154, 121.517925], [25.000181, 121.517902], [25.000204, 121.517897], [25.000233, 121.517897], [25.000266, 121.517909], [25.000298, 121.517925], [25.000326, 121.517943], [25.000366, 121.517972], [25.000409, 121.518011], [25.000449, 121.518057], [25.000491, 121.518100], [25.000535, 121.518136], [25.000590, 121.518167], [25.000637, 121.518196], [25.000683, 121.518215], [25.000709, 121.518237], [25.000725, 121.518267], [25.000736, 121.518303], [25.000732, 121.518350], [25.000717, 121.518394], [25.000702, 121.518436], [25.000682, 121.518477], [25.000661, 121.518520], [25.000648, 121.518558], [25.000637, 121.518598], [25.000615, 121.518656], [25.000612, 121.518693], [25.000614, 121.518725], [25.000608, 121.518772], [25.000600, 121.518809], [25.000595, 121.518843], [25.000595, 121.518889], [25.000605, 121.518920], [25.000584, 121.518946], [25.000550, 121.518950], [25.000507, 121.518952], [25.000457, 121.518950], [25.000403, 121.518961], [25.000373, 121.518979], [25.000330, 121.519003], [25.000289, 121.519007], [25.000254, 121.519005], [25.000226, 121.518980], [25.000195, 121.518966], [25.000162, 121.518959], [25.000125, 121.518952], [25.000090, 121.518949]].map(([a, b]) => new google.maps.LatLng(a, b)))

    //     this.gmap.addListener('zoom_changed', _ => this.gmap.zoom !== this.lastZoom && this.fetchAll(false, this.lastZoom = this.gmap.zoom))
    //     this.gmap.addListener('click', e => console.error(e.latLng.lat() + ', ' + e.latLng.lng()))

    //     this.socket.on('logs', devices => {
    //       return this.devices = devices, this.device === null && this.devices.length
    //         ? this.fetchAll(this.device = this.devices[0])
    //         : this.fetchAll(false, this.device = this.devices.filter(device => device.id == this.device.id).shift())
    //     })

    }))
    this.socket.on('aaa', _ => {
      console.error(_);
    })
    this.socket.on('connect_error', _ => this.error = '連線失敗，請稍後再試！')
    this.socket.on('disconnect', _ => this.error = '已經斷線，請重新整理畫面！')

  },
  computed: {

  },
  methods: {
    
  },
  template: El.render(`
    main#app
      div#error => *if=error
        span => *text=error

      div#map => ref=map

      div#online => *text=total

      `)
})
